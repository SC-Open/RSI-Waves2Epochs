<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RSI-Waves2Epochs | An SC-Open.dev Project</title>
<link rel="stylesheet" href="css/styles.css">
<link rel="stylesheet" href="css/footer.css">
</head>
<body>
    <div id="appArea">
        <p id="label">Paste your copied wave schedule here:</p>
        <textarea id="inputData" name="input" placeholder="Wave # HHMM UTC - Month DD&#10;Wave # HHMM UTC - Month DD&#10;Wave # HHMM UTC - Month DD"></textarea>
        <pre id="outputText"></pre>
        <button type="button" id="actionButton" title="Convert UTC Waves to Discord Epochs">Convert</button>
     </div>
     <footer id="footer">
        <button id="aboutButton" type="button">About</button>
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h1>Like what we're doing? </h1><p>Here are some ways you can show your appreciation</p>
                <div id="badges">
                    <object title="GitHub Organization Badge" data="https://img.shields.io/badge/SC--Open-gold?style=for-the-badge&link=https%3A%2F%2Fgithub.com%2FSC-Open" type="image/svg+xml"></object>
                    <object title="GitHub Repo Badge" data="https://img.shields.io/badge/RSI--Waves2Epochs-blue?style=for-the-badge&logo=github&link=https%3A%2F%2Fgithub.com%2FSC-Open%2FRSI-Waves2Epochs" type="image/svg+xml"></object>
                    <object title="GitHub License Badge" data="https://img.shields.io/github/license/sc-open/RSI-Waves2Epochs?style=for-the-badge" type="image/svg+xml"></object>
                    <object title="GitHub Sponsors Badge" data="https://img.shields.io/github/sponsors/mistermatt1337?style=for-the-badge&logo=githubsponsors&link=https%3A%2F%2Fbit.ly%2F3TP4yKD" type="image/svg+xml"></object>
                    <object title="Patreon Sponsors Badge" data="https://img.shields.io/badge/Patreon-Support_us!-orange?style=for-the-badge&logo=patreon&link=https%3A%2F%2Fbit.ly%2FSCOpenDevPatreon" type="image/svg+xml"></object>
                    <object title="RSI Referral Badge" data="https://img.shields.io/badge/RSI-Enlist_now!-blue?style=for-the-badge&logo=spaceship&link=https%3A%2F%2Fbit.ly%2FSCBonus5K" type="image/svg+xml"></object>
                    <object title="Discord Badge" data="https://img.shields.io/discord/1113924866580684911?style=for-the-badge&logo=discord&logoColor=white&label=SC%20Open&color=gold&link=https%3A%2F%2Fbit.ly%2FSCOpen-Discord" type="image/svg+xml"></object>
                </div>
            </div>
        </div>
        <p id="disclaimer">This is an unofficial Star Citizen fansite, not affiliated with the Cloud Imperium group of companies. All content on this site not authored by its host or users are property of their respective owners.</p>
    </footer>
    <script>
        function convertWavesToEpochs(text) {
            const waveDateTimeRegex = /(wave \d+).*\b(\d{4})\b.*UTC.*\b(\w+)\b (\d{2})/gi;
            let match;
            const epochs = [];
            while ((match = waveDateTimeRegex.exec(text)) !== null) {
                const waveInfo = match[1];
                const militaryTime = match[2];
                const month = match[3];
                const day = match[4];
                const hours = parseInt(militaryTime.slice(0, 2), 10);
                const minutes = parseInt(militaryTime.slice(2, 4), 10);
                const monthIndex = new Date(Date.parse(month +" 1, 2012")).getMonth();
                const currentYear = new Date().getFullYear();
                const timestamp = Date.UTC(currentYear, monthIndex, day, hours, minutes) / 1000;
                epochs.push([waveInfo, timestamp]);
            }
            const formattedEpochs = epochs.map(([waveInfo, epoch]) => {
                const date = new Date(epoch * 1000);
                const formattedDate = `<t:${Math.floor(epoch)}:f>`;
                return waveInfo + ': ' + formattedDate;
            });
            return formattedEpochs.join('\n');
        }
        function createNotification(message) {
            const notification = document.createElement('div');
            notification.innerText = message;
            notification.classList.add('notification');
            const existingNotifications = document.querySelectorAll('.notification').length;
            const topPosition = 10 + (existingNotifications * 60); // Adjust the multiplier based on the height of your notifications
            notification.style.top = `${topPosition}px`;
            document.body.appendChild(notification);
            setTimeout(() => {
                document.body.removeChild(notification);
                updateNotificationPositions();
            }, 3000); // Hide after 3 seconds
        }
        function updateNotificationPositions() {
            const notifications = document.querySelectorAll('.notification');
            notifications.forEach((notification, index) => {
                const topPosition = 10 + (index * 60); // Adjust the multiplier based on the height of your notifications
                notification.style.top = `${topPosition}px`;
            });
        }
        document.getElementById('actionButton').addEventListener('click', function(event) {
            event.preventDefault();
            console.log('actionButton clicked');
            if (this.innerText.trim().toLowerCase() === 'convert') {
                const text = document.getElementById('inputData').value;
                if (text.trim() === '') {
                    createNotification('No text to convert!');
                } else {
                    const output = convertWavesToEpochs(text);
                    if (output.trim() === '') {
                        createNotification('No waves found!');
                    } else {
                        document.getElementById('outputText').innerText = output;
                        createNotification('Conversion completed!');                 
                        document.getElementById('inputData').style.display = 'none';
                        document.getElementById('inputData').value = '';
                        document.getElementById('outputText').style.display = 'block';
                        this.innerText = 'Copy';
                        this.title = 'Copy converted wave schedule to clipboard';
                        document.getElementById('label').innerText = 'Your converted wave schedule:';                       
                    }
                }
            } else if (this.innerText.trim().toLowerCase() === 'copy') {
                const outputText = document.getElementById('outputText');
                if (outputText.innerText.trim() === '') {
                    createNotification('No text to copy!');
                } else {
                    navigator.clipboard.writeText(outputText.innerText).then(() => {
                        createNotification('Copied to clipboard!');
                        document.getElementById('outputText').style.display = 'none';
                        document.getElementById('outputText').innerText = '';
                        document.getElementById('inputData').style.display = 'block';
                        this.innerText = 'Convert';
                        this.title = 'Converted wave schedule to Discord Epochs';
                        document.getElementById('label').innerText = 'Paste your copied wave schedule here:';
                    });
                }
            }
        });
        document.getElementById('aboutButton').addEventListener('click', function() {
            openModal();
        });
        function openModal() {
            console.log('openModal');
            var modal = document.getElementById("myModal");
            var span = document.getElementsByClassName("close")[0];
            modal.style.display = "block";
            span.addEventListener('click', function() {
                closeModal(modal);
            });
            window.addEventListener('click', function(event) {
                closeOnOutsideClick(event, modal);
            });
        }
        function closeModal(modal) {
            modal.style.display = "none";
        }
        function closeOnOutsideClick(event, modal) {
            if (event.target == modal) {
                event.stopPropagation();
                modal.style.display = "none";
            }
        }
    </script>
</body>
</html>